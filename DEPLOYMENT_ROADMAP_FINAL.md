# 🚀 SEOom Builder 배포 로드맵 (최종 정리)

**작성일:** 2025년 1월  
**목표:** Cloudflare 연동 및 커스텀 도메인 지원 포함한 전체 배포 계획

---

## 📋 목차

1. [현재 상태 요약](#현재-상태-요약)
2. [배포 전 필수 작업](#배포-전-필수-작업)
3. [배포 단계별 계획](#배포-단계별-계획)
4. [도메인 시스템 구현](#도메인-시스템-구현)
5. [배포 후 작업](#배포-후-작업)

---

## ✅ 현재 상태 요약

### 완료된 작업 (약 95%)

#### 기능 개발 (100%)
- ✅ 기본 인프라 및 개발 환경
- ✅ 핵심 기능 (게시판, 게시글, 댓글, 검색 등)
- ✅ 관리자 기능
- ✅ 마스터 콘솔
- ✅ 위젯 시스템
- ✅ 알림 시스템
- ✅ 결제 시스템 (토스페이먼츠)
- ✅ UI/UX

#### 데이터베이스 구조
- ✅ `sites` 테이블에 `domain` 필드 존재
- ✅ 도메인 저장 기능 구현됨

### 미완료 작업 (배포 전 필수)

#### 1. 도메인 라우팅 구현 (필수)
- ❌ 도메인 기반 라우팅 미들웨어
- ❌ 서브도메인 자동 인식
- ❌ 커스텀 도메인 라우팅

#### 2. 배포 환경 구축 (필수)
- ❌ AWS EC2 서버 설정
- ❌ Apache + PHP-FPM 설정
- ❌ Cloudflare 연동

#### 3. 보안 강화 (권장)
- ⚠️ Rate Limiting 부분 적용
- ⚠️ Cloudflare Real IP 설정 필요

---

## 🔧 배포 전 필수 작업

### Phase 1: 도메인 라우팅 구현 (1-2일)

#### 작업 1-1: 도메인 라우팅 미들웨어 생성
**우선순위:** 🔴 최우선  
**예상 시간:** 2-3시간

**작업 내용:**
1. `ResolveSiteByDomain` 미들웨어 생성
2. 도메인 기반 사이트 조회 로직
3. 서브도메인 파싱 로직
4. 커스텀 도메인 조회 로직

**파일:**
- `app/Http/Middleware/ResolveSiteByDomain.php` (신규)

#### 작업 1-2: 라우트 수정
**우선순위:** 🔴 최우선  
**예상 시간:** 2-3시간

**작업 내용:**
1. 도메인 기반 라우트 그룹 추가
2. 기존 슬러그 기반 라우트 유지 (하위 호환성)
3. 라우트 우선순위 조정

**파일:**
- `routes/web.php` (수정)

#### 작업 1-3: 설정 파일 추가
**우선순위:** 🔴 최우선  
**예상 시간:** 30분

**작업 내용:**
1. `config/app.php`에 마스터 도메인 설정 추가
2. `.env.example` 업데이트

**파일:**
- `config/app.php` (수정)
- `.env.example` (수정)

#### 작업 1-4: 테스트
**우선순위:** 🔴 최우선  
**예상 시간:** 1-2시간

**작업 내용:**
1. 로컬에서 도메인 라우팅 테스트
2. 서브도메인 테스트
3. 커스텀 도메인 테스트

---

### Phase 2: 배포 환경 구축 (1주)

#### 작업 2-1: AWS EC2 서버 설정
**우선순위:** 🔴 최우선  
**예상 시간:** 2-3시간

**작업 내용:**
1. EC2 인스턴스 생성
2. Elastic IP 할당
3. 보안 그룹 설정
4. SSH 접속 확인

**참고:** `DEPLOYMENT_GUIDE.md` 3장 참조

#### 작업 2-2: 서버 환경 구축
**우선순위:** 🔴 최우선  
**예상 시간:** 3-4시간

**작업 내용:**
1. PHP 8.3 설치
2. Composer 설치
3. MySQL 설치 및 설정
4. Apache 설치 및 설정
5. Git 설치

**참고:** `DEPLOYMENT_GUIDE.md` 4장 참조

#### 작업 2-3: 프로젝트 배포
**우선순위:** 🔴 최우선  
**예상 시간:** 2-3시간

**작업 내용:**
1. 코드 배포 (Git clone 또는 업로드)
2. 의존성 설치
3. 환경 변수 설정
4. 마이그레이션 실행
5. 파일 권한 설정

**참고:** `DEPLOYMENT_GUIDE.md` 4장 참조

#### 작업 2-4: Cloudflare 설정
**우선순위:** 🔴 최우선  
**예상 시간:** 2-3시간

**작업 내용:**
1. Cloudflare 계정 생성
2. 도메인 추가
3. DNS 레코드 설정
4. SSL/TLS 설정
5. 보안 설정

**참고:** `DEPLOYMENT_GUIDE.md` 5장 참조

---

### Phase 3: 보안 강화 (2-3일)

#### 작업 3-1: Cloudflare Real IP 설정
**우선순위:** 🟡 높음  
**예상 시간:** 1시간

**작업 내용:**
1. `TrustProxies` 미들웨어 수정
2. Cloudflare IP 범위 확인

**파일:**
- `app/Http/Middleware/TrustProxies.php` (수정)

#### 작업 3-2: Rate Limiting 강화
**우선순위:** 🟡 높음  
**예상 시간:** 2-3시간

**작업 내용:**
1. 로그인 시도 제한
2. API 요청 제한
3. 파일 업로드 제한

**파일:**
- `app/Http/Kernel.php` (수정)
- `routes/web.php` (수정)

#### 작업 3-3: 보안 헤더 설정
**우선순위:** 🟡 높음  
**예상 시간:** 1시간

**작업 내용:**
1. Apache 보안 헤더 설정
2. CSP 헤더 설정 (선택)

**파일:**
- `/etc/apache2/sites-available/seoom.conf` (수정)

---

## 📅 배포 단계별 계획

### Week 1: 도메인 라우팅 구현 및 테스트

**Day 1-2: 도메인 라우팅 구현**
- [ ] `ResolveSiteByDomain` 미들웨어 생성
- [ ] 라우트 수정
- [ ] 설정 파일 추가
- [ ] 로컬 테스트

**Day 3-4: 배포 환경 준비**
- [ ] AWS EC2 인스턴스 생성
- [ ] 서버 환경 구축 시작

**Day 5: 통합 테스트**
- [ ] 전체 기능 테스트
- [ ] 도메인 라우팅 테스트

### Week 2: 배포 환경 구축 및 배포

**Day 1-2: 서버 환경 완성**
- [ ] PHP, MySQL, Apache 설정 완료
- [ ] 프로젝트 배포
- [ ] 기본 기능 확인

**Day 3-4: Cloudflare 설정**
- [ ] Cloudflare 계정 설정
- [ ] DNS 레코드 설정
- [ ] SSL/TLS 설정
- [ ] 보안 설정

**Day 5: 배포 및 테스트**
- [ ] 실제 배포
- [ ] 도메인 접속 확인
- [ ] 기능 테스트
- [ ] 성능 확인

### Week 3: 보안 강화 및 최적화

**Day 1-2: 보안 강화**
- [ ] Cloudflare Real IP 설정
- [ ] Rate Limiting 강화
- [ ] 보안 헤더 설정

**Day 3-4: 최적화**
- [ ] 캐시 설정
- [ ] 이미지 최적화
- [ ] 쿼리 최적화

**Day 5: 문서화 및 마무리**
- [ ] 배포 문서 정리
- [ ] 사용자 가이드 작성
- [ ] 최종 확인

---

## 🌐 도메인 시스템 구현

### 도메인 구조

```
1. 마스터 도메인
   - seoom.com (또는 seoom.kr)
   - 마스터 콘솔 접근
   - 메인 사이트

2. 무료 서브도메인
   - {site-slug}.seoom.com
   - 예: test-site.seoom.com
   - 자동 생성

3. 커스텀 도메인
   - 사용자가 연결한 도메인
   - 예: example.com
   - 관리자 페이지에서 설정
```

### 구현 방법

#### 1. 도메인 라우팅 우선순위

1. **도메인 기반 라우팅** (최우선)
   - 요청 도메인으로 사이트 조회
   - 서브도메인 또는 커스텀 도메인

2. **슬러그 기반 라우팅** (하위 호환)
   - `/site/{slug}/` 형태
   - 기존 방식 유지

#### 2. 데이터베이스 구조

`sites` 테이블:
- `slug`: 서브도메인용 (예: `test-site`)
- `domain`: 커스텀 도메인 (예: `example.com`)
- 둘 다 있을 수 있음

#### 3. 라우팅 로직

```
요청 도메인 확인
  ↓
마스터 도메인? → 마스터 사이트 처리
  ↓
서브도메인? → slug로 사이트 조회
  ↓
커스텀 도메인? → domain으로 사이트 조회
  ↓
사이트 없음 → 404
```

---

## 📝 배포 후 작업

### 즉시 작업 (배포 직후)

1. **기본 기능 확인**
   - [ ] 메인 페이지 접속
   - [ ] 마스터 로그인
   - [ ] 사이트 생성
   - [ ] 게시판/게시글 기능

2. **도메인 확인**
   - [ ] 마스터 도메인 접속
   - [ ] 서브도메인 접속
   - [ ] 커스텀 도메인 접속 (테스트)

3. **SSL 확인**
   - [ ] HTTPS 접속
   - [ ] 인증서 유효성
   - [ ] HTTP → HTTPS 리다이렉션

### 단기 작업 (1주일 내)

1. **모니터링 설정**
   - [ ] 에러 추적 시스템 (Sentry 등)
   - [ ] 성능 모니터링
   - [ ] 로그 모니터링

2. **백업 시스템**
   - [ ] 자동 백업 스크립트
   - [ ] 백업 스케줄 설정
   - [ ] 복구 테스트

3. **문서화**
   - [ ] 사용자 가이드
   - [ ] 관리자 가이드
   - [ ] 배포 가이드 정리

### 중기 작업 (1개월 내)

1. **성능 최적화**
   - [ ] Redis 캐싱 도입
   - [ ] 이미지 최적화
   - [ ] CDN 연동

2. **추가 기능**
   - [ ] 사용자 요청 기능
   - [ ] 관리자 페이지 개선

---

## 🎯 작업 우선순위 요약

### 🔴 최우선 (배포 전 필수)

1. **도메인 라우팅 구현** (1-2일)
   - 미들웨어 생성
   - 라우트 수정
   - 테스트

2. **배포 환경 구축** (1주)
   - AWS EC2 설정
   - 서버 환경 구축
   - Cloudflare 설정

### 🟡 높음 (배포 직후)

3. **보안 강화** (2-3일)
   - Cloudflare Real IP
   - Rate Limiting
   - 보안 헤더

4. **모니터링 설정** (1-2일)
   - 에러 추적
   - 성능 모니터링

### 🟢 중간 (배포 후 1주일 내)

5. **백업 시스템** (1일)
6. **문서화** (2-3일)
7. **성능 최적화** (1주)

---

## 📚 참고 문서

- [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) - 상세 배포 가이드
- [PROJECT_STATUS_REVIEW.md](./PROJECT_STATUS_REVIEW.md) - 프로젝트 상태 평가
- [PROJECT_ROADMAP.md](./PROJECT_ROADMAP.md) - 전체 프로젝트 로드맵

---

## ✅ 체크리스트

### 배포 전 체크리스트

- [ ] 도메인 라우팅 미들웨어 생성
- [ ] 라우트 수정 완료
- [ ] 로컬 테스트 완료
- [ ] AWS EC2 인스턴스 생성
- [ ] 서버 환경 구축 완료
- [ ] Cloudflare 계정 생성
- [ ] DNS 레코드 설정
- [ ] SSL/TLS 설정
- [ ] 보안 설정 완료

### 배포 후 체크리스트

- [ ] 메인 페이지 접속 확인
- [ ] 마스터 로그인 확인
- [ ] 사이트 생성 확인
- [ ] 서브도메인 접속 확인
- [ ] 커스텀 도메인 접속 확인
- [ ] SSL 인증서 확인
- [ ] 기능 테스트 완료
- [ ] 성능 확인 완료

---

**마지막 업데이트:** 2025년 1월  
**다음 단계:** 도메인 라우팅 구현부터 시작

